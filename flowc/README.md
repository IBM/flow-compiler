# Prerequisites

## gRPC compiler with C++ plugin

### On macOs with brew:
```bash
brew install grpc
```

### On Linux:
```bash
git clone -b $(curl -L https://grpc.io/release) https://github.com/grpc/grpc
cd grpc && git submodule update --init 
mkdir -p cmake/build && cd cmake/build 
cmake -DgRPC_INSTALL=ON -DgRPC_BUILD_TESTS=OFF ../.. 
make -j$(nproc) 
make install 
```
## Lemon (optional)
The parser for the flow compiler (defined in [flow-parser.Y](flow-parser.Y)) is generated with **lemon**. The generated files are checked in, so **lemon** is only needed if you make changes to the parser.

More information about **lemon** can be found here [http://www.hwaci.com/sw/lemon/](http://www.hwaci.com/sw/lemon/)
```bash 
make lemon 
echo "LEMON=./lemon" >> makefile.local
```

### On macOS with MacPorts or brew:
```bash
sudo port install lemon
```
or
```bash
brew install lemon
```


## Docker and Docker Compose (optional)
**Docker** is needed for creating the final application image. The image is necessary to run in either **Docker Compose** or **Kubernetes** mode.

**Docker** instructions are here [https://docs.docker.com/install/](https://docs.docker.com/install/) and **Docker Compose** instructions are here [https://docs.docker.com/compose/install/](https://docs.docker.com/compose/install/).


## kubectl (optional)
**kubectl** is the necessary tool to interact with **Kubernetes** clusters. The deployment tool generated by **flowc** uses **kubectl**. 

Installation instructions can be found here: [https://kubernetes.io/docs/tasks/tools/install-kubectl/](https://kubernetes.io/docs/tasks/tools/install-kubectl/)

## graphviz (optional)
**dot**, from the **graphviz** toolkit is used to generate a call flow diagram. Details can be found here: [http://www.graphviz.org](http://www.graphviz.org)

# Installation

Follow these two steps to get ready to build an application. The second step is olny necessary if the final orchestrator application is to be run in its own **docker** container.

# Build (and Install) flowc
```bash        
make 
sudo make install INSTALL_PREFIX=/usr/local/bin 
```

# Build the Docker Image
Applications can be encapsulated in their own **docker** image. 
To build an image that has flowc and all the necessary tools: 
```bash
make image
```

# Building and Running an Orchestrator

See here [how to](../HOWTO-FLOW.md) construct a flow application.

This will generate the **gRPC** server code for orchestrator application. All files will be written in the current directory.
A different output directory can be specified with **-o**
```bash
flowc my-project.flow --server
```    
Make sure to let **flowc** know about  the location of all the included **.proto** files with the **-I** option:
```bash
flowc -I proto-dir my-project --server
```

The application server binary can be built using the generated **makefile** or by running **flowc** with the **--build-server** option.

To build the **docker** orchestrator image use option **--build-image**. This will build an image tagged **_my-project:1_**:
```bash
flowc my-project.flow --build-image
```    


    





